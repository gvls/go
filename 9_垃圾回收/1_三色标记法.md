##  三色标记法
GO的垃圾回收方法


###   过程
初始状态下所有对象都是白色
1. 从根节点开始遍历所有对象，把遍历到的对象变成 灰色
2. 遍历灰色的对象，将灰色对象引用的对象变成 灰色，然后将遍历过的灰色对象变成黑色
3. 循环 第3步，直到灰色对象都变成黑色
4. 通过 写屏障 检测对象有变化，重复上面的操作
5. 回收 所有白色对象（垃圾） 
  


###   STW
为了避免在GC的过程中，对象之间的引用关系发生变更（如GC过程中新增了一个引用，但是由于未扫描到该引用导致将被引用的对象清除了），使得GC的结果发生错误。
作用：停止所有正在运行的`goroutine` 
* 缺点
对性能有影响，但目前可以做到1ms以下的STW




###   写屏障
因为STW影响程序的性能，使用写屏障可以尽可能缩短STW的时间

####    造成引用对象丢失的条件
一个黑色的节点A新增了指向白色节点C的引用，并且白色节点C没有除了A之外的其他灰色节点的引用，或者存在但是在GC过程中被删除了。以上两个条件需要同时满足：满足条件1时说明节点A已扫描完毕，A指向C的引用无法再被扫描到；满足条件2时说明白色节点C无其他灰色节点的引用了，即扫描结束后会被忽略 。


####    解决丢失的可能
写屏障破坏两个条件其一即可

* 破坏条件1：Dijistra写屏障
满足强三色不变性：黑色节点不允许引用白色节点 当黑色节点新增了白色节点的引用时，将对应的白色节点改为灰色

* 破坏条件2：Yuasa写屏障
满足弱三色不变性：黑色节点允许引用白色节点，但是该白色节点有其他灰色节点间接的引用（确保不会被遗漏） 当白色节点被删除了一个引用时，悲观地认为它一定会被一个黑色节点新增引用，所以将它置为灰色
